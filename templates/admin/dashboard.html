{% extends "admin/base.html" %}

{% block content %}
<div class="topbar">
    <div class="titleBlock">
        <h2>Dashboard</h2>
        <p>Overview of all managed blogs and agencies</p>
    </div>
    <div class="actions flex items-center gap-3">
        <a href="/admin/posts/new"
            class="btn bg-blue-600 hover:bg-blue-500 text-white border-blue-500/50 shadow-[0_0_15px_rgba(37,99,235,0.4)]">
            <span class="mr-1 text-lg">+</span> New Post
        </a>
        <a href="/admin/logout" class="btn border-white/10 hover:bg-white/5">Logout</a>
    </div>
</div>

<!-- Work Queue Board (UX-1) -->
<div class="h-full overflow-x-auto pb-4">
    <div class="flex gap-6 min-w-max h-full">

        <!-- Loop through columns defined in backend -->
        {% for status, items in board.items() %}
        <div class="w-80 flex-shrink-0 flex flex-col glass-panel rounded-xl border border-white/10 bg-[#0a0a0c]/40">
            <!-- Column Header -->
            <div
                class="p-4 border-b border-white/5 flex justify-between items-center sticky top-0 bg-[#0a0a0c]/80 backdrop-blur-sm rounded-t-xl z-10">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full 
                            {% if status == 'Draft' %}bg-gray-500
                            {% elif status == 'InReview' %}bg-blue-400
                            {% elif status == 'ChangesRequested' %}bg-amber-400
                            {% elif status == 'Published' %}bg-green-400
                            {% endif %}">
                    </div>
                    <h3 class="font-mono text-xs uppercase tracking-widest text-gray-300">{{ status }}</h3>
                </div>
                <span class="text-xs font-bold text-gray-600 bg-white/5 px-2 py-0.5 rounded">{{ items|length }}</span>
            </div>

            <!-- Column Content (Tiles) -->
            <div class="p-3 space-y-3 overflow-y-auto custom-scrollbar flex-1">
                {% for item in items %}
                <div class="group relative p-4 rounded-lg border border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all cursor-pointer"
                    onclick="window.location.href='/admin/blogs/{{ item.blog_id }}/posts/{{ item.id }}'">

                    <!-- Metadata Row -->
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] font-mono text-gray-500">{{ item.date }}</span>
                        <!-- Contract Badge -->
                        <span class="text-[9px] px-1.5 py-0.5 rounded border 
                                {% if item.contract == 'v2.0' %}border-purple-500/30 text-purple-400 bg-purple-500/10
                                {% else %}border-gray-600 text-gray-500{% endif %}">
                            {{ item.contract }}
                        </span>
                    </div>

                    <!-- Title -->
                    <h4 class="text-sm font-medium text-gray-200 group-hover:text-white leading-snug mb-3">
                        {{ item.title }}
                    </h4>

                    <!-- Footer Row -->
                    <div class="flex items-center justify-between mt-auto">
                        <!-- Author/Objective -->
                        <div class="flex items-center gap-2">
                            <div
                                class="w-5 h-5 rounded-full bg-white/10 flex items-center justify-center text-[10px] text-gray-400">
                                {{ item.author[:1] }}
                            </div>
                            <span class="text-[10px] text-gray-500 truncate max-w-[80px]">{{ item.author }}</span>
                        </div>

                        <!-- QA Score (if exists and not -) -->
                        {% if item.score != '-' %}
                        <div class="flex items-center gap-1" title="QA Score">
                            <span class="text-[10px] font-mono 
                                    {% if item.score|int > 80 %}text-green-400
                                    {% elif item.score|int > 50 %}text-amber-400
                                    {% else %}text-red-400{% endif %}">
                                {{ item.score }}
                            </span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}

                {% if items|length == 0 %}
                <div class="text-center py-8 opacity-30">
                    <div class="text-2xl mb-1">âˆ…</div>
                    <div class="text-[10px] uppercase tracking-widest">No Items</div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}

    </div>
</div>
{% endblock %}