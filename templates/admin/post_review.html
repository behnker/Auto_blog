{% extends "admin/base.html" %}

{% block content %}
<div class="topbar">
    <div class="titleBlock">
        <div class="crumbs">Admin / Blogs / {{ blog.name }} / Review</div>
        <h2 class="text-xl font-bold text-white tracking-wide">Post Studio</h2>
    </div>
    <div class="actions">
        <span class="text-xs font-mono text-gray-500 uppercase tracking-widest mr-4">{{ post.status }}</span>
        <a href="/post/{{ post.slug }}" target="_blank" class="btn secondary">Preview</a>
    </div>
</div>

<div class="grid grid-cols-12 gap-8 pb-20">

    <!-- LEFT COLUMN: Content & SEO (7 Cols) -->
    <div class="col-span-12 lg:col-span-7 space-y-6">

        <!-- Main Content Editor (Preview Mode for now) -->
        <div class="glass-panel p-8 rounded-xl border border-white/10 bg-[#0a0a0c]/50 backdrop-blur-md">
            <!-- Editable Title -->
            <input type="text" name="title" form="editor-form" value="{{ post.title }}"
                class="w-full bg-transparent text-3xl font-black text-white mb-6 leading-tight border-none focus:ring-0 outline-none placeholder-gray-700"
                placeholder="Untitled Post">

            <div
                class="prose prose-invert max-w-none prose-p:text-gray-300 prose-headings:text-white prose-a:text-blue-400">
                <!-- Using a simple textarea for quick editing in this Phase, or markdown render -->
                <form id="editor-form" method="POST" action="/admin/posts/save_content">
                    <input type="hidden" name="blog_id" value="{{ blog.id }}">
                    <input type="hidden" name="post_id" value="{{ post.id }}">

                    <label class="block text-xs font-mono text-gray-500 uppercase mb-2">Content (Markdown)</label>
                    <textarea name="content"
                        class="w-full h-[600px] bg-[#050507] border border-white/10 rounded-lg p-4 text-gray-300 font-mono text-sm focus:border-blue-500/50 outline-none resize-none leading-relaxed custom-scrollbar">{{ post.content }}</textarea>

                    <div class="flex justify-end mt-4">
                        <button type="submit" class="btn text-xs">Save Content</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- SEO Pack -->
        <div class="glass-panel p-6 rounded-xl border border-white/10 bg-white/5">
            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-4">SEO & Metadata</h3>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Slug</label>
                    <input value="{{ post.slug }}"
                        class="w-full bg-black/20 border border-white/10 rounded px-3 py-2 text-sm text-gray-300"
                        readonly>
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Primary Keyword</label>
                    <input value="{{ post.primary_keyword }}"
                        class="w-full bg-black/20 border border-white/10 rounded px-3 py-2 text-sm text-gray-300"
                        readonly>
                </div>
                <div class="col-span-2">
                    <label class="block text-xs text-gray-500 mb-1">Meta Description</label>
                    <textarea
                        class="w-full bg-black/20 border border-white/10 rounded px-3 py-2 text-sm text-gray-300 h-20"
                        readonly>{{ post.meta_description }}</textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- RIGHT COLUMN: Workflow & Authenticity (5 Cols) -->
    <div class="col-span-12 lg:col-span-5 space-y-6">

        <!-- Workflow Actions -->
        <div class="glass-panel p-6 rounded-xl border border-blue-500/20 bg-blue-900/10 backdrop-blur-md sticky top-6">
            <h3 class="text-sm font-bold text-blue-300 uppercase tracking-widest mb-4 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-blue-400"></span> Workflow
            </h3>

            <div class="space-y-4">
                <div class="flex justify-between items-center text-sm text-gray-400">
                    <span>Current Status</span>
                    <span class="text-white font-bold">{{ post.status }}</span>
                </div>
                <div class="flex justify-between items-center text-sm text-gray-400">
                    {% if request.query_params.success %}
                    <div
                        class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded shadow-xl z-50 animate-bounce">
                        ✅ {{ request.query_params.success }}
                    </div>
                    {% endif %}
                    {% if request.query_params.error %}
                    <div
                        class="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded shadow-xl z-50 animate-pulse">
                        ❌ {{ request.query_params.error }}
                    </div>
                    {% endif %}

                    <span>Assigned Author</span>
                    <select name="author_id" form="editor-form"
                        class="bg-black/20 border border-white/10 rounded px-2 py-1 text-xs text-white outline-none focus:border-blue-500">
                        <option value="">-- Unassigned --</option>
                        {% for a in authors %}
                        <option value="{{ a.id }}" {% if post.author_name==a.name %}selected{% endif %}>{{ a.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="h-[1px] bg-white/10 my-4"></div>

                <div class="flex flex-col gap-3">
                    {% if post.status == 'Draft' or post.status == 'ChangesRequested' %}
                    <form action="/admin/posts/status" method="POST">
                        <input type="hidden" name="blog_id" value="{{ blog.id }}">
                        <input type="hidden" name="post_id" value="{{ post.id }}">
                        <input type="hidden" name="status_action" value="submit">
                        <button type="submit"
                            class="w-full py-3 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-bold uppercase tracking-wide text-xs transition-all shadow-[0_0_20px_rgba(37,99,235,0.3)]">
                            Submit for Review
                        </button>
                    </form>
                    {% elif post.status == 'InReview' %}
                    <div class="grid grid-cols-2 gap-3">
                        <form action="/admin/posts/status" method="POST" class="w-full">
                            <input type="hidden" name="blog_id" value="{{ blog.id }}">
                            <input type="hidden" name="post_id" value="{{ post.id }}">
                            <input type="hidden" name="status_action" value="request_changes">
                            <button type="submit"
                                class="w-full py-3 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/30 font-bold uppercase tracking-wide text-xs">
                                Request Changes
                            </button>
                        </form>
                        <form action="/admin/posts/status" method="POST" class="w-full">
                            <input type="hidden" name="blog_id" value="{{ blog.id }}">
                            <input type="hidden" name="post_id" value="{{ post.id }}">
                            <input type="hidden" name="status_action" value="approve">
                            <button type="submit"
                                class="w-full py-3 rounded-lg bg-green-600 hover:bg-green-500 text-white font-bold uppercase tracking-wide text-xs shadow-[0_0_20px_rgba(22,163,74,0.3)]">
                                Approve
                            </button>
                        </form>
                    </div>
                    {% endif %}

                    {% if post.status != 'Draft' and post.status != 'Published' %}
                    <form action="/admin/posts/status" method="POST">
                        <input type="hidden" name="blog_id" value="{{ blog.id }}">
                        <input type="hidden" name="post_id" value="{{ post.id }}">
                        <input type="hidden" name="status_action" value="draft">
                        <button type="submit"
                            class="w-full py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 font-bold uppercase tracking-wide text-[10px]">
                            Revert to Draft
                        </button>
                    </form>
                    {% endif %}
                </div>

                <div class="pt-4 border-t border-white/5">
                    <form action="/admin/posts/delete" method="POST"
                        onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.');">
                        <input type="hidden" name="blog_id" value="{{ blog.id }}">
                        <input type="hidden" name="post_id" value="{{ post.id }}">
                        <button type="submit"
                            class="w-full py-2 rounded-lg border border-red-500/20 hover:bg-red-500/10 text-red-500 font-bold uppercase tracking-wide text-[10px] transition-colors">
                            Delete Post
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Authenticity Panel (UX-1) -->
        <div class="glass-panel p-6 rounded-xl border border-amber-500/20 bg-amber-900/5">
            <h3 class="text-sm font-bold text-amber-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                <span class="icon">★</span> Human Authenticity
            </h3>

            <form class="space-y-5">
                <!-- Quote -->
                <div class="space-y-2">
                    <label class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase">
                        <input type="checkbox" class="accent-amber-500" {% if post.auth_quote %}checked{% endif %}>
                        Expert Quote
                    </label>
                    <textarea placeholder="Paste a unique quote here..."
                        class="w-full bg-black/20 border border-white/5 rounded px-3 py-2 text-sm text-gray-300 h-20 focus:border-amber-500/50 outline-none transition-colors"></textarea>
                </div>

                <!-- Opinion -->
                <div class="space-y-2">
                    <label class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase">
                        <input type="checkbox" class="accent-amber-500"> Unique Opinion
                    </label>
                    <textarea placeholder="Add a contrarian or personal take..."
                        class="w-full bg-black/20 border border-white/5 rounded px-3 py-2 text-sm text-gray-300 h-20 focus:border-amber-500/50 outline-none transition-colors"></textarea>
                </div>
            </form>
        </div>

        <!-- QA Score -->
        {% if post.qa_score %}
        <div
            class="glass-panel p-6 rounded-xl border border-white/10 bg-white/5 flex items-center justify-between group cursor-help">
            <div>
                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-1">QA Score</h3>
                <div class="text-[10px] text-gray-600">Geo-Spatial AEO</div>
            </div>
            <div
                class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-br from-white to-gray-500 group-hover:from-green-400 group-hover:to-blue-500 transition-all duration-500">
                {{ post.qa_score }}
            </div>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}